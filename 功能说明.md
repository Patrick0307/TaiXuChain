# 钱包角色绑定功能说明

## 🎮 核心功能

现在你的游戏已经实现了：

1. ✅ **每个钱包只能创建一个角色**
2. ✅ **已注册的钱包再次登录时自动加载角色**
3. ✅ **跳过角色创建流程，直接进入地图选择**
4. ✅ **显示完整的角色信息和预览**

## 🚀 如何测试

### 启动服务

**后端：**
```bash
cd taixu-backend
npm start
```

**前端：**
```bash
cd taixuchain
npm run dev
```

### 测试场景 1：新玩家首次注册

1. 打开游戏 `http://localhost:5173`
2. 连接一个**从未使用过的钱包**
3. 你会看到：
   - 🔍 检查角色中...
   - ➡️ 进入角色创建流程
   - 🎨 选择职业 → 自定义外观 → 输入名字
   - ⛓️ 角色注册到区块链（免费，无需 gas）
   - 🗺️ 进入地图选择

### 测试场景 2：老玩家再次登录

1. 刷新页面或重新打开游戏
2. 连接**刚才创建角色的钱包**
3. 你会看到：
   - 🔍 检查角色中...
   - ✨ **直接跳转到地图选择**（跳过角色创建！）
   - 👤 显示你的角色信息：
     - 角色动画预览
     - 名字、职业、等级
     - 区块链 ID

## 📋 实现细节

### 后端新增 API

```
GET /api/player/:address
```

查询钱包地址是否已有角色，返回角色完整信息。

### 前端流程

```
连接钱包
  ↓
查询是否已有角色
  ↓
  ├─ 有角色 → 加载数据 → 地图选择
  └─ 无角色 → 创建角色 → 地图选择
```

### 数据保存

所有角色数据都保存在区块链上：
- 基本信息（名字、职业、等级）
- 外观数据（性别、肤色、发型、服装等）
- 永久绑定到钱包地址

## 🎯 关键特性

1. **一钱包一角色**
   - 每个钱包只能创建一个角色
   - 角色是 SBT（灵魂绑定代币），不可转移

2. **自动识别**
   - 系统自动检测钱包是否已有角色
   - 无需手动选择

3. **数据持久化**
   - 角色数据永久保存在区块链
   - 任何设备都能通过钱包访问

4. **免费创建**
   - 使用赞助交易
   - 玩家无需支付 gas 费用

## 🔧 调试信息

打开浏览器控制台（F12）可以看到：

- `🎮 Loading existing character...` - 找到已有角色
- `ℹ️ No existing character...` - 新钱包，开始创建
- `✅ Existing player found:` - 角色数据详情

## ❓ 常见问题

**Q: 我想创建第二个角色怎么办？**
A: 目前每个钱包只能有一个角色。如果需要多个角色，请使用不同的钱包。

**Q: 我的角色数据会丢失吗？**
A: 不会！所有数据都保存在区块链上，永久有效。

**Q: 换电脑还能用同一个角色吗？**
A: 可以！只要使用同一个钱包连接，就能加载你的角色。

**Q: 创建角色需要付费吗？**
A: 不需要！游戏使用赞助交易，所有费用由游戏方支付。

## 📝 修改的文件

### 后端
- `taixu-backend/server.js` - 添加查询 API
- `taixu-backend/services/sponsorService.js` - 添加查询函数

### 前端
- `taixuchain/src/App.jsx` - 添加角色检查逻辑
- `taixuchain/src/utils/suiClient.js` - 添加查询函数
- `taixuchain/src/components/MapSelection.jsx` - 增强显示

## 🎉 完成！

现在你的游戏已经支持：
- ✅ 钱包角色绑定
- ✅ 自动登录
- ✅ 角色数据持久化
- ✅ 完整的用户体验

开始测试吧！🚀
